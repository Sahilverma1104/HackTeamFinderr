<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Find Teams</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="styles.css">

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
</head>

<body>

<nav class="navbar">
  <div class="logo">ğŸ‘¥ HackTeamFinder</div>
  <div class="nav-links">
      <a href="index.html"><span class="emoji">ğŸ </span> Home</a>
      <a href="hackathon.html"><span class="emoji">ğŸ‘¤</span> Hackathons</a>
      <a href="find-teams.html"><span class="emoji">ğŸ‘¥</span> Teams</a>
    </div>
  <div class="user-profile" style="cursor:pointer;" onclick="window.location.href='user.html'">
      <span id="navUserName">Profile</span>
    </div>
</nav>

<div class="container">
  <h1>Student Professionals</h1>
  <div class="card-grid" id="cardGrid"></div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCYiSAF6Z4m0AHL7ZXi_loWk0qTJAw1pfI",
    authDomain: "hackteamfinder.firebaseapp.com",
    databaseURL: "https://hackteamfinder-default-rtdb.asia-southeast1.firebasedatabase.app/",
    projectId: "hackteamfinder"
  };

  firebase.initializeApp(firebaseConfig);

  const myEmail = localStorage.getItem("userEmail");
  const myName  = localStorage.getItem("userName");

  if (!myEmail) {
    alert("User not logged in");
    location.href = "index.html";
  }

  const myId = myEmail.replace(/[@.]/g, "_");
  document.getElementById("navUserName").innerText = myName;

  const grid = document.querySelector(".card-grid");

  firebase.database().ref("users").once("value")
    .then(snapshot => {
      const users = snapshot.val();
      grid.innerHTML = "";

      if (!users) {
        grid.innerHTML = "<p>No users found</p>";
        return;
      }

      Object.keys(users).forEach(uid => {
        const user = users[uid];

        // ğŸ” guards
        if (!user || !user.bio) return;
        if (uid === myId) return; // skip self

        // reconstruct email from uid
        const email = uid.replace(/_/g, ".").replace(".gmail.com", "@gmail.com");

        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h2>${user.bio}</h2>
          <p>${email}</p>
          <p><b>Role:</b> ${user.role || "Not set"}</p>
          <p><b>Skills:</b> ${user.skills || "Not set"}</p>
          <button onclick="openChat('${uid}')">Chat</button>
        `;
        grid.appendChild(card);
      });
    })
    .catch(err => {
      console.error("Firebase error:", err);
    });

  function openChat(otherUid) {
    location.href = `chatroom.html?id=${otherUid}`;
  }
</script>

<script>
  if (!localStorage.getItem("userEmail")) {
    window.location.href = "index.html";
  }
</script>



</body>
</html>
